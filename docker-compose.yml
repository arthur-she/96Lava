version: "2"

services:

  lava-master:
    hostname: lava-master
    restart: always
    build:
      context: ./lava-master
      args:
        admin_username: "loic"
        admin_password: "password"
        admin_email: "admin@localhost.com"
    ports:
      - "80:80"           # http
      - "5555:5555"       # logger
      - "5556:5556"       # master
    network_mode: "host"
    extra_hosts:
      - "worker0:127.0.0.1" # local-instance

  lava-worker:
    hostname: worker0
    restart: always
    build:
      context: ./lava-worker
      args:
        board: "db820c"
    volumes:
      - /dev:/dev
      - /boot:/boot
      - /lib/modules:/lib/modules
      - /sys/class/gpio:/sys/class/gpio:rw # Power control via GPIO
      - /tmp:/tmp                          # overlayfs nfs export workaround
      - /var/tmp/:/var/tmp/
      - /var/cache:/var/cache/
      - /sys/fs/cgroup:/sys/fs/cgroup:rw # lxc
      - /sys/devices/virtual/net:/sys/devices/virtual/net:rw # lxc net interface
    privileged: true
    ports:
      - "69:69"        # tftp
      - "2049:2049"    # nfs4
    network_mode: "host"
    extra_hosts:
      - "lava-master:127.0.0.1" # local-instance
